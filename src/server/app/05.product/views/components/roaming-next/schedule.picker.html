<div id="scheduleDialog" class="dialog">
    <div class="header">
        <img class="banner" width="100%" />
        <div class="summary">
            <h1><span id="target-nation"></span>, 언제 떠나세요?</h1>
            <div>
                <div class="date">
                    <h2>가는날</h2>
                    <h3 id="date-depart">-</h3>
                </div>
                <div class="date">
                    <h2>오는날</h2>
                    <h3 id="date-arrive">-</h3>
                </div>
            </div>
        </div>
        <div class="close" onclick="closeDialog()">
            <img src="<%= CDN %>/img/product/roam/ico_close_w.svg" width="20" height="20" alt="Close"/>
        </div>
    </div>
    <div id="scheduleContent"><div id="calendar"></div></div>
    <div id="scheduleConfirm" class="bottom-button not-prepared" onclick="tryConfirm();">
        추천 요금제 확인
    </div>
</div>
<script type="text/javascript">
  function openScheduleDialog(code, name, topBannerUrl, baseDiv) {
    $('#scheduleDialog').css('display', 'block');
    $(baseDiv).css('display', 'none');

    $('#date-depart').html('-');
    $('#date-arrive').html('-');
    if (!topBannerUrl) {
      $('#scheduleDialog .banner').attr('src', '');
      $.get('/product/roaming?queryBg=' + code, function(data) {
        var cdn = '<%= CDN %>';
        if (cdn.indexOf(':3001') > 0) {
          cdn = 'http://cdnm-dev.tworld.co.kr';
        }
        $('#scheduleDialog .banner').attr('src', cdn + data.backgroundUrl);
      });
    } else {
      $('#scheduleDialog .banner').attr('src', topBannerUrl);
    }
    $('#target-nation').html(name);
    $('#target-nation').attr('data-code', code);

    $('div#calendar').daterangepicker({
      element: $('div#calendar'),
      parentEl: 'div#calendar',
      minDate: moment().add(1, 'days').format('YYYY-MM-DD'),
    }, function(start, end) {
      if (start && end && end.diff(start, 'days') <= 30) {
        $('#scheduleConfirm').removeClass('not-prepared');
      } else {
        $('#scheduleConfirm').addClass('not-prepared');
      }

      if (start) {
        $('#date-depart').html(start.format('YYYY.MM.DD'));
      }
      if (end) {
        $('#date-arrive').html(end.format('YYYY.MM.DD'));
      } else {
        $('#date-arrive').html('-');
      }
    });
  }
  function tryConfirm() {
    const classes = $('#scheduleConfirm').attr('class');
    if (classes.indexOf('not-prepared') >= 0) {
      return false;
    }

    var startDate = moment($('#date-depart').html(), 'YYYY.MM.DD');
    var endDate = moment($('#date-arrive').html(), 'YYYY.MM.DD');
    if (endDate.diff(startDate, 'days') > 30) {
      alert('30일 이상은 선택하실 수 없습니다.');
      return false;
    }
    var countryCode = $('#target-nation').attr('data-code');
    document.location.href = '/product/roaming/offer?code=' + countryCode +
      '&from=' + startDate.format('YYYYMMDD') +
      '&to=' + endDate.format('YYYYMMDD');
    closeDialog();
  }
</script>
