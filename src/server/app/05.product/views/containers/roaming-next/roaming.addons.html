<%- include('../../components/start.component.html', { pageInfo: locals.pageInfo, includeRoam: true }); %>
<body class="rn">
<div id="roamingAddons">
    <div id="gnb" class="gnb-opaque">
        <span class="menu icon-gnb-menu">
            <img src="<%= CDN %>/img/product/roam/ico_menu_b.svg" alt="메뉴" width="24" height="24" />
        </span>
        <h1>T로밍 부가서비스</h1>
    </div>
    <%- include('../components/header.component.html', { title: 'T로밍 부가서비스', svcInfo: svcInfo }) %>
    <div class="filters">
        <h2>부가서비스 종류</h2>
        <% Object.keys(filters).map(filterId => {%>
        <span class="tag" id="tag<%= filterId %>" onclick="toggleFilter('<%= filterId %>')">
            #<%= filters[filterId] %>
        </span>
        <% }) %>
    </div>
    <div class="items">
    </div>
</div>
<%- include('../../components/roaming-next/roaming.menu.html', {svcInfo}); %>
</body>
<% include ../../components/javascript.component.html %>
<script type="text/x-handlebars-template" id="tpl-item">
    <div class="item">
        {{#if using}}
        <span class="status inuse">이용중</span>
        {{else}}
            <% if (svcInfo && svcInfo.mbrNm) { %>
            <a href="/product/roaming/join/confirm-info?prod_id={{ prodId }}">
              <span class="status">가입가능</span>
            </a>
            <% } %>
        {{/if}}
        <a href="/product/callplan?prod_id={{ prodId }}">
        <h3 class="name">{{ prodNm }}<span class="comment">{{ basFeeAmt.value }}</span></h3>
        </a>
        {{#each filters}}
        <span class="tag">#{{ prodFltNm }}</span>
        {{/each}}
        <p class="description">{{ prodSmryDesc }}</p>
    </div>
</script>
<script type="text/javascript">
  $(document).on('ready', function () {
    new Tw.NextRoamingMenu($('#roamingAddons')).install();
    fillItems();
  });

  function fillItems() {
    var activeTags = $('.filters span.active');
    var activeIds = [];
    for (var i=0; i<activeTags.length; i++) {
      var filterId = activeTags[i].id.substring(3);
      activeIds .push(filterId);
    }

    const itemsDiv = document.querySelector('#roamingAddons .items');
    itemsDiv.innerHTML = '';
    const template = Handlebars.compile($('#tpl-item').html());
    for (var item of items) {
      item.using = using.indexOf(item.prodId) != -1;
      if (activeIds.length > 0) {
        for (var filter of item.filters) {
          if (activeIds.indexOf(filter.prodFltId) >= 0) {
            itemsDiv.innerHTML += template(item);
            break;
          }
        }
        continue;
      }
      itemsDiv.innerHTML += template(item);
    }
  }

  function toggleFilter(filterId) {
    var dom = document.getElementById('tag' + filterId);
    var className = dom.className;
    if (className.indexOf('active') >= 0) {
      dom.className = 'tag';
    } else {
      dom.className = 'tag active';
    }
    fillItems();
  }

  var items = <%- JSON.stringify(addonData.products) %>;
  var using = <%- JSON.stringify(addonUsing) %>;
</script>
<% include ../../components/end.component.html %>
