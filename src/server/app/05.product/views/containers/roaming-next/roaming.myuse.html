<%- include('../../components/start.component.html', { pageInfo: locals.pageInfo, includeRoam: true }); %>
<body class="rn">
<div id="roamingMyuse" class="wrap">
    <!-- //웹접근성 hearder 삭제-->
    <%- include('../components/header.component.html', { title: '나의 T로밍 이용 현황', svcInfo: svcInfo }) %>
    
    <div id="contents" class="mt60">

        <!-- 로밍 히스토리 있는 경우만 액션시트 버튼 노출 되도록 분기 처리 if조건 필요 -->
        <% if (historyList) { %>
		<!-- [OP002-11060] [로밍][M] 로밍이력조회 요청 건 -->
		<div class="rm-myuse-dropdown">
			<button class="bt-dropdown" id="fe-category" title="보기 선택" aria-haspopup="true">
				<span class="txt" id="fe-category-name"><%= categoryName %></span>
				<!-- <span class="txt"><%= categoryName %></span> -->
				<span class="ico"></span>
			</button>
		</div>
        <!-- // [OP002-11060] [로밍][M] 로밍이력조회 요청 건 -->
        <% } %>

    <div id="my-use-area" style="display: none">  <!-- myuse 영역 -->
        <!-- 로밍요금제 시작 -->
        <div class="card">
            <h2>
                로밍 요금제
                <span class="count">총 <span class="colorPoint" id="countTariff"><%= tariffs.length %></span>건</span>
            </h2>
            <% if (tariffs.length === 0) { %>
            <div class="empty">
                <img src="<%= CDN %>/img/product/roam/ico_empty.svg" />
                <p>
                    이용 중인 로밍 요금제가 없습니다.
                </p>
            </div>
            <% } %>
            <% for (var tariff of tariffs) { %>
            <div class="item">
                <a href="/product/callplan?prod_id=<%= tariff.prodId %>">
                    <h3>
                        <%= tariff.prodNm %>
                        <img class="arrow" src="<%= CDN %>/img/product/roam/ico_arrow.png" width="13" />
                    </h3>
                </a>
                <div class="row">
                    <% if (tariff.startDate.isAfter(now)) { %>
                    <span class="label colorPoint fontsize15">이용 예정</span>
                    <%# D-DAY 는 시/분/초 데이터를 제거한 뒤 계산 %>
                    <span class="value colorPoint bold">D-<%= Math.floor(tariff.startDate.hours(0).minutes(0).seconds(0).milliseconds(0).diff(nowDate) / 86400000) %></span>
                    <% } else if (tariff.endDate && tariff.endDate.isBefore(now)) { %>
                    <span class="label fontsize15">이용 완료</span>
                    <span class="value bold"><%= Math.floor(now.diff(tariff.endDate) / 86400000) %>일 지남</span>
                    <% } else { %>
                    <span class="label colorPoint fontsize15">이용 중</span>
                        <% if (tariff.endDate) { %>
                        <span class="value colorPoint bold"><%= Math.floor(tariff.endDate.diff(now) / 86400000) %>일 남음</span>
                        <% } %>
                    <% } %>
                </div>
                <div class="row">
                    <% if (tariff.endDate) { %>
                        <span class="label colorGray">가입 기간</span>
                        <span class="value colorGray">
                            <%= tariff.startDate.format('YYYY. M. D.') %> <%= tariff.startTime %>
                            -
                            <%= tariff.endDate.format('YYYY. M. D.') %> <%= tariff.endTime %>
                        </span>
                    <% } else { %>
                        <span class="label colorGray">가입일</span>
                        <span class="value colorGray"><%= tariff.scrbDt %></span>
                    <% } %>
                </div>

                <%# 요금제별로 설정 버튼이 있는 경우 %>
                <% for (var button of tariff.btnList) { %>
                <div class="row">
                    <a href="<%= button.btnLinkUrl %>?prod_id=<%= tariff.linkProdId %>">
                    <span class="value button">
                        <%= button.btnNm %>
                    </span>
                    </a>
                </div>
                <% } %>

                <% if (tariff.data || tariff.phone || tariff.sms) { %>
                <div class="divider"></div>
                <% } %>

                <% if (tariff.data) { %>
                <div class="row mt6">
                    <span class="label">데이터</span>
                </div>
                <div class="row">
                    <span class="label colorGray">제공량</span>
                    <span class="value bold"><%= tariff.data.total %></span>
                </div>
                    <% if (tariff.data.used) { %>
                <div class="row">
                    <span class="label colorGray">사용량</span>
                    <span class="value bold"><%= tariff.data.used %></span>
                </div>
                    <% } %>
                <% } %>

                <% if (tariff.sms) { %>
                <div class="row mt6">
                    <span class="label">문자메시지</span>
                </div>
                <div class="row">
                    <span class="label colorGray">제공량</span>
                    <span class="value bold"><%= tariff.sms.total %></span>
                </div>
                <% } %>

                <% if (tariff.phone) { %>
                <div class="row mt6">
                    <span class="label">음성</span>
                </div>
                <div class="row">
                    <span class="label colorGray">제공량</span>
                    <span class="value bold"><%= tariff.phone.total %></span>
                </div>
                <% } %>
            </div>
            <% } %>
        </div>
        <div class="card">
            <h2>
                로밍 부가서비스
                <span class="count">총 <span class="colorPoint" id="countAddon"><%= addons.length %></span>건</span>
            </h2>
            <% if (addons.length === 0) { %>
            <div class="empty">
                <img src="<%= CDN %>/img/product/roam/ico_empty.svg" />
                <p>
                    이용 중인 로밍 부가서비스가 없습니다.
                </p>
            </div>
            <% } %>
            <% for (var addon of addons) { %>
            <div class="item">
                <a href="/product/callplan?prod_id=<%= addon.prodId %>">
                    <h3>
                        <%= addon.prodNm %>
                        <img class="arrow" src="<%= CDN %>/img/product/roam/ico_arrow.png" width="13" />
                    </h3>
                </a>
                <div class="row">
                    <span class="label colorPoint fontsize15">이용 중</span>
                </div>
                <div class="row">
                    <span class="label colorGray">가입일</span>
                    <span class="value colorGray"><%= addon.scrbDt %></span>
                </div>
                <%# 부가서비스는 btnList 가 간혹 있다 %>
                <% for (var button of addon.btnList) { %>
                    <div class="row">
                        <a href="<%= button.btnLinkUrl %>?prod_id=<%= addon.prodId %>">
                    <span class="value button">
                        <%= button.btnNm %>
                    </span>
                        </a>
                    </div>
                <% } %>
            </div>
            <% } %>
        </div>
        <!-- end of 로밍 요금제 -->
        <!-- history가 있는 유저는 아래내용 보여주되 숨기기 - 카테고리2로 들어온 유저는 바로 이 영역부터 보여주기 categoryNumber === '2' -->
    </div> <!-- end of my-use-area -->
    <% if (historyList) { %>
        <%- include('../../components/roaming-next/roaming.history.html', {svcInfo: svcInfo}); %>
    <% } %>

    </div> <!-- end of contents -->
    <div class="h36"></div>
    <%- include('../../../../../common/views/components/footer.component.html', { svcInfo: svcInfo, pageInfo: pageInfo }) %>
</div>
<%- include('../../components/roaming-next/roaming.menu.html', {svcInfo}); %>
</body>
<% include ../../components/javascript.component.html %>
<script type="text/javascript">
  $(document).ready(function () {
    new Tw.RoamingMyuse($('#roamingMyuse'), JSON.parse('<%- JSON.stringify(historyList) %>'), JSON.parse('<%- JSON.stringify(categoryNumber) %>'));
  });
</script>
<% include ../../components/end.component.html %>
