<%- include('../../components/start.component.html', { pageInfo: locals.pageInfo, includeRoam: true }); %>
<body class="rn">
<div id="roamingTariffs">
    <div id="gnb" class="gnb-opaque">
        <span class="menu icon-gnb-menu">
            <img src="<%= CDN %>/img/product/roam/ico_menu_b.svg" alt="컨텍스트 메뉴" width="24" height="24" />
        </span>
        <h1>T로밍 요금제</h1>
    </div>
    <%- include('../components/header.component.html', { title: 'T로밍 요금제', svcInfo: svcInfo }) %>
    <div class="header">
        <h2>나의 여행 <span class="colorPoint">패턴</span>을 <span class="colorPoint">선택</span>해보세요!</h2>
        <div class="anchors">
            <div class="anchor" id="a-group-baro" onclick="showGroup(this)">
                <img src="<%= CDN %>/img/product/roam/tab_01_on.png" width="128" />
            </div>
            <div class="anchor" id="a-group-onepass" onclick="showGroup(this)">
                <img src="<%= CDN %>/img/product/roam/tab_02_off.png" width="128" />
            </div>
            <div class="anchor" id="a-group-vip" onclick="showGroup(this)">
                <img src="<%= CDN %>/img/product/roam/tab_03_off.png" width="128" />
            </div>
            <div class="anchor" id="a-group-guam" onclick="showGroup(this)">
                <img src="<%= CDN %>/img/product/roam/tab_04_off.png" width="128" />
            </div>
            <div class="anchor" id="a-group-longpass" onclick="showGroup(this)">
                <img src="<%= CDN %>/img/product/roam/tab_05_off.png" width="128" />
            </div>
        </div>
    </div>
    <div id="groups">
    </div>
</div>
<script type="text/x-handlebars-template" id="tpl-tariff-group">
    <div class="group" id="{{id}}">
        <div class="summary">
            <img src="<%= CDN %>/img/product/roam/{{ background }}" />
            <h2>{{ name }}</h2>
            <p>
                {{{ description }}}
            </p>
        </div>
        <div class="tariffs">
            {{#each items}}
                <div class="tariff" onclick="showPlan('{{ id }}');">
                    <span class="price">{{ price }}</span>
                    <h3>{{ name }}</h3>
                    <div class="data">
                        <img src="<%= CDN %>/img/product/roam/ico_storage.svg" width="12" height="12" alt="storage" />
                        <span>{{ data }}</span>
                    </div>
                    <span class="phone">{{ phone }}</span>
                </div>
            {{/each}}
        </div>
    </div>
</script>
<%- include('../../components/roaming-next/roaming.menu.html'); %>
</body>
<% include ../../components/javascript.component.html %>
<script type="text/javascript">
  const groups = [
    {
      name: 'baro 요금제',
      description: '아시아, 미주, 유럽, 호주 어디에서나 저렴한 가격과<br />넉넉한 데이터로 고품질의 baro통화를 이용하세요',
      id: 'group-baro',
      background: 'img_baro01.png',
      items: [
        {name: 'baro 3GB', data: '3GB', phone: 'baro통화 무제한', price: '29,000원/7일', id: 'NA00006489'},
        {name: 'baro 4GB', data: '4GB', phone: 'baro통화 무제한', price: '39,000원/30일', id: 'NA00006493'},
        {name: 'baro 7GB', data: '7GB', phone: 'baro통화 무제한', price: '59,000원/30일', id: 'NA00006497'},
      ]
    },
    {
      name: 'baro OnePass',
      description: '짧은 여행이나 출장을 자주 갈 때, <br />전 세계에서 1일 단위로 데이터를 이용하세요!',
      id: 'group-onepass',
      background: 'img_baro02.png',
      items: [
        {name: 'baro OnePass 300 기본형', data: '300MB', phone: 'baro통화 무제한', price: '9,900원/1일', id: 'NA00003196'},
        {name: 'baro OnePass 300 기간형', data: '300MB', phone: 'baro통화 무제한', price: '9,900원/1일', id: 'NA00003196'},
        {name: 'baro OnePass 500 기본형', data: '500MB', phone: 'baro통화 무제한', price: '16,500원/1일', id: 'NA00005049'},
        {name: 'baro OnePass 500 기간형', data: '500MB', phone: 'baro통화 무제한', price: '16,500원/1일', id: 'NA00005049'},
      ]
    },
    {
      name: 'baro OnePass Data / VIP',
      description: '전 세계에서 1일 단위로 데이터 걱정 없이<br />무제한으로 이용하세요!',
      id: 'group-vip',
      background: 'img_baro03.png',
      items: [
        {name: 'baro OnePass VIP 기본형', data: '데이터 무제한', phone: '음성30분 / 문자30건 / baro통화 무제한', price: '19,000원/1일', id: 'NA00006486'},
        {name: 'baro OnePass VIP 기간형', data: '데이터 무제한', phone: '음성30분 / 문자30건 / baro통화 무제한', price: '19,000원/1일', id: 'NA00006486'},
        {name: 'baro OnePass Data VIP 기본형', data: '데이터 무제한', phone: 'baro통화 무제한', price: '17,600원/1일', id: 'NA00006744'},
        {name: 'baro OnePass Data VIP', data: '데이터 무제한', phone: 'baro통화 무제한', price: '17,600원/1일', id: 'NA00006744'},
      ]
    },
    {
      name: '괌·사이판',
      description: '괌 사이판 여행, 국내 가입 요금제의 기본제공<br />데이터를 그대로 이용하세요!',
      id: 'group-guam',
      background: 'img_baro04.png',
      items: [
        {name: 'T괌 사이판 국내처럼', data: '요금제 유형별 이용안내 상세참고', phone: 'baro통화 무제한', price: '무료', id: 'NA00006226'},
        {name: 'T괌 사이판 5천원', data: '500MB', phone: '문자 기본제공 / baro통화 무제한', price: '5,000원/10일', id: 'NA00006229'},
      ]
    },
    {
      name: 'T로밍 LongPass',
      description: '괌 사이판 여행, 국내 가입 요금제의 기본제공<br />데이터를 그대로 이용하세요!',
      id: 'group-longpass',
      background: 'img_baro05.png',
      items: [
        {name: 'T로밍 LongPass 2GB', data: '2GB', phone: 'baro통화 무제한', price: '40,000원/30일', id: 'NA00005300'},
        {name: 'T로밍 LongPass 3GB', data: '3GB', phone: 'baro통화 무제한', price: '50,000원/30일', id: 'NA00005505'},
        {name: 'T로밍 LongPass 5GB', data: '5GB', phone: 'baro통화 무제한', price: '65,000원/30일', id: 'NA00005252'},
      ]
    },
  ];
  const groupMetas = {
    'group-baro': {top: 0, height: 0},
    'group-onepass': {},
    'group-vip': {},
    'group-guam': {},
    'group-longpass': {},
  }
  const imagePrefix = "<%= CDN %>/img/product/roam/tab_0";
  var scrollMonitor = true;
  var selectedAnchor = 'a-group-baro';

  function showPlan(id) {
    var path = '/product/callplan?prod_id=' + id;
    document.location.href = path;
  }

  $(document).ready(function () {
    fillTariffs();
    initScrollAnchors();
    new Tw.NextRoamingMenu($('#roamingTariffs')).install();

    var i0 = document.location.href.lastIndexOf('#');
    if (i0 !== -1) {
      var hash = document.location.href.substring(i0 + 1);
      showGroupImpl('group-' + hash, 'a-group-' + hash);
    }
  });

  function initScrollAnchors() {
    for (var k of Object.keys(groupMetas)) {
      var div = document.getElementById(k);
      groupMetas[k].top = div.offsetTop;
      groupMetas[k].height = div.offsetHeight;
    }
    console.log(groupMetas);

    var anchors = $('.header .anchors');
    $(window).scroll(function(e) {
      if (!scrollMonitor)
        return;

      var scrollTop = $(window).scrollTop();
      if (scrollTop > 63) {
        anchors.css('position', 'fixed');
        anchors.css('left', '0');
        anchors.css('right', '0');
        anchors.css('top', '50px');
        anchors.css('height', '94px');

        for (var k of Object.keys(groupMetas)) {
          var meta = groupMetas[k];
          if (scrollTop > meta.top - 145 && scrollTop < meta.top - 145 + meta.height) {
            const thatId = 'a-' + k;
            $('.header .anchor').each(function(i, val) {
              var state = val.id === thatId ? 'on' : 'off';
              $('#' + val.id + ' img').attr('src', imagePrefix + (i+1) + '_' + state + '.png');
              if (state === 'on' && selectedAnchor !== thatId) {
                var offsetLeft = val.offsetLeft - 20;
                $('.anchors').animate({
                  scrollLeft: offsetLeft,
                }, 250);
                selectedAnchor = thatId;
              }
            });
            break;
          }
        }
      } else {
        anchors.css('position', 'static');
      }
    });
  }

  function showGroup(e) {
    var groupId = e.id.substring(2);
    showGroupImpl(groupId, e.id);
  }

  function showGroupImpl(groupId, anchorId) {
    scrollMonitor = false;
    $([document.documentElement, document.body]).animate({
      scrollTop: groupMetas[groupId].top - 145,
    }, 280, function() {
      scrollMonitor = true;
    });

    $('.header .anchor').each(function(i, val) {
      var state = val.id === anchorId ? 'on' : 'off';
      $('#' + val.id + ' img').attr('src', imagePrefix + (i+1) + '_' + state + '.png');

      if (state === 'on') {
        var offsetLeft = val.offsetLeft - 20;
        $('.anchors').animate({
          scrollLeft: offsetLeft,
        }, 200);
      }
    });

  }

  function fillTariffs() {
    const template = Handlebars.compile($('#tpl-tariff-group').html());
    const target = document.getElementById('groups');
    target.innerHTML = '';
    for (var group of groups) {
      target.innerHTML += template(group);
    }
  }
</script>
<% include ../../components/end.component.html %>
