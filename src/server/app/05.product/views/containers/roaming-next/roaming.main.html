<%- include('../../components/start.component.html',
  {
    pageInfo: locals.pageInfo,
    includeRoam: true,
    includeCalendar: true,
  });
%>
<body class="rn">
<div id="roamingMain">
    <div id="gnb">
        <span class="menu icon-gnb-menu">
            <img src="<%= CDN %>/img/product/roam/ico_menu_b.svg" alt="메뉴" width="24" height="24" />
        </span>
        <img class="logo" src="<%= CDN %>/img/product/roam/logo.png" alt="로고" width="94" height="24" />
    </div>
    <img class="background" src="<%= CDN %>/img/product/roam/bg-map.png" alt="배경"/>
    <%- include('../components/header.component.html', { title: 'T로밍', svcInfo: svcInfo }) %>
    <div id="contents">
        <h2>해외여행 갈 땐</h2>
        <h2 class="colorPoint">T로밍과 함께 !</h2>
        <p class="description">
            T로밍 요금제를 통해 해외에서도 국내처럼 <br />
            자유롭게 baro 통화하세요.
        </p>
        <div class="card">
            <h3>국가별 맞춤 로밍 요금제 추천</h3>
            <p class="description">여행하실 나라를 선택해주세요</p>
            <div id="nations">
                <ul></ul> 
            </div>
            <p class="description">찾으시는 나라가 없으신가요?</p>
            <form action="#" onsubmit="searchNation(); return false;">
                <div class="field-container">
                    <input type="text" placeholder="원하시는 국가 명을 입력해주세요" id="nation-search" />
                    <img src="<%= CDN %>/img/product/roam/ico_search_a.png" width="21" height="21" alt="Search" />
                </div>
            </form>
            <div class="link">
                <a href="#" onclick="openNationsDialog(); return false;">전체 국가보기</a>
            </div>
        </div>
        <div class="banner">
            <a href="/product/roaming/info/barocall">
                <img src="<%= CDN %>/img/product/roam/banner_01.png" alt="광고배너 Baro 통화" />
            </a>
        </div>
        <div class="card">
            <h3>로밍 요금제 한눈에 보기</h3>
            <div id="groups">
            </div>
        </div>
        <div class="card no-padding">
            <a href="/product/roaming/coupon">
                <div class="menu-link border-bottom">
                    <img class="icon" src="<%= CDN %>/img/product/roam/ico_coupon.png" width="32" />
                    <span>로밍 카드/쿠폰</span>
                    <img class="arrow" src="<%= CDN %>/img/product/roam/ico_arrow.png" width="13" />
                </div>
            </a>
            <a href="/product/roaming/fi/guide">
                <div class="menu-link">
                    <img class="icon" src="<%= CDN %>/img/product/roam/ico_barobox.png" width="32" />
                    <span>baro Box 대여</span>
                    <img class="arrow" src="<%= CDN %>/img/product/roam/ico_arrow.png" width="13" />
                </div>
            </a>
        </div>
    </div>
    <a href="/product/roaming/info/guide">
        <div class="info-link">
            출국 전 알아두면 좋은 정보
            <img class="arrow" src="<%= CDN %>/img/product/roam/ico_arrow.png" width="13" />
        </div>
    </a>
    <a href="/product/roaming/info/guide?reqItem=lost">
        <div class="info-link" style="border-bottom: 1px solid #ededed;">
            <div class="separator-top"></div>
            로밍 중 휴대폰 분실 안내
            <img class="arrow" src="<%= CDN %>/img/product/roam/ico_arrow.png" width="13" />
        </div>
    </a>
    <div class="links">
        <div class="other-link">
            <a href="/product/roaming/info/center">로밍 센터 안내</a>
        </div>
        <div class="divider"></div>
        <div class="other-link">
            <a href="/customer/faq/category?id=1400000&title=%EB%A1%9C%EB%B0%8D">자주하는 질문</a>
        </div>
    </div>
</div>
<div id="nationsDialog" class="dialog">
    <div class="header">
        <h1>로밍 가능한 전체 국가</h1>
        <div class="close" onclick="closeDialog()">
            <img src="<%= CDN %>/img/product/roam/ico_close.svg" width="20" height="20" />
        </div>
    </div>
    <div class="menu">
        <ul>
            <li id="major">주요국가</li>
            <li id="europe">유럽</li>
            <li id="asia">아시아</li>
            <li id="america">미주</li>
            <li id="oceania">오세아니아</li>
            <li id="middleeast">중동</li>
            <li id="africa">아프리카</li>
        </ul>
    </div>
    <div class="content">
        <ul>

        </ul>
    </div>
</div>
<%- include('../../components/roaming-next/schedule.picker.html'); %>
<%- include('../../components/roaming-next/roaming.menu.html'); %>
<script type="text/x-handlebars-template" id="tpl-nation-card">
    <li style="width: {{width}}px; height: {{height}}px;"
        onclick="openScheduleDialog('{{ code }}', '{{ name }}', '{{ imageTopUrl }}', '#roamingMain');">
        {{#if imageUrl}}
            <img src="{{ imageUrl }}" width="{{ width }}" height="{{ height }}" alt="{{ imageAlt }}">
            <span class="name">{{ name }}</span>
        {{else}}
            <span class="flag-icon flag-icon-{{ code2 }}"></span>
            <span class="name-dark">{{ name }}</span>
        {{/if}}
    </li>
</script>
<script type="text/x-handlebars-template" id="tpl-tariff-group-card">
    <a href="/product/roaming/tariffs#{{ id }}">
        <div class="group">
            <img src="<%= CDN %>/img/product/roam/{{ icon }}" alt="product-icon" />
            <h4>{{ title }}</h4>
            <h5>{{ subtitle }}</h5>
        </div>
    </a>
</script>
</body>
<% include ../../components/javascript.component.html %>
<script type="text/javascript">
  $(document).ready(function () {
    // new Tw.NextRoamingMenu($('#roamingMain')).install();
    new Tw.NextRoaming($('#roamingMain'), '<%= pageInfo.menuId %>')
    fillPopularNations();
    fillTariffGroups();

    prepareNations();
    $('#nation-search').autocomplete({
      source: allNations,
      delay: 100,
      minLength: 1,
    });
    setupNationsDialog();

    var menu = new Tw.MenuComponent();
    $('#gnb .menu').on('click', function() {
      menu._onGnbBtnClicked();
    });
    $('#header').hide();
  });
  function prepareNations() {
    let all = [];
    const categories = Object.keys(nations);
    for (let i=0; i<categories.length; i+=1) {
      let category = categories[i];
      if (category === 'major')
        continue;
      const items = nations[category].split(', ');
      all = all.concat(items);
    }
    all.sort();
    allNations = all;
  }
  function setupNationsDialog() {
    const menuItems = $('#nationsDialog .menu li');
    for (var i=0; i<menuItems.length; i++) {
      menuItems[i].onclick = function (event) {
        onClickNationGroup(event.target)
      };
    }
  }
  function onClickNationGroup(menu) {
    $('#nationsDialog .menu li').removeClass('active');
    menu.className = 'active';
    const selectedNations = nations[menu.id].split(', ')
    const targetList = $('#nationsDialog .content ul')
    targetList.html('');
    for (var nation of selectedNations) {
      var li = document.createElement('li');
      li.onclick = function(e) {
        var nationName = e.target.innerText
        openScheduleDialog('ETC', nationName);
      };
      li.innerText = nation;
      targetList.append(li);
    }
  }
  function searchNation() {
    try {
      var nationName = $('#nation-search').val();
      openScheduleDialog('ETC', nationName);
    } catch (e) {
      console.error(e);
    }
  }

  function fillPopularNations() {
    const GAP = 6;
    const COLUMN = 3;
    const container = document.getElementById('nations');
    const nationWidth = Math.floor((container.clientWidth - GAP * COLUMN) / COLUMN);
    const ul = document.querySelector('#nations ul');
    const template = Handlebars.compile($('#tpl-nation-card').html());

    for (let i = 0; i < popularNations.length; i++) {
      const item = popularNations[i];
      var imageUrl = '<%= CDN %>/adminupload/' + item.mblBtnImg + '.png';
      if (!item.mblBtnImg) {
        imageUrl = null;
        if (sampleImages[item.countryCode] != null) {
          imageUrl = sampleImages[item.countryCode];
        }
      }
      const li = template({
        width: nationWidth - GAP,
        height: (nationWidth - GAP) * 0.727,
        name: item.countryNameKor,
        code: item.countryCode,
        code2: ISO3166[item.countryCode][0].toLowerCase(),
        imageUrl: imageUrl,
        imageAlt: item.mblBtnImgAltCtt,
        imageTopUrl: '',
      });
      ul.innerHTML += li;
    }

    // for (let i = 0; i < popularNationList.length; i++) {
    //   const item = popularNationList[i];
    //   const li = template({
    //     width: nationWidth - GAP,
    //     name: item.name,
    //     code: item.code,
    //     imageUrl: item.url,
    //     imageTopUrl: item.topUrl,
    //   });
    //   ul.innerHTML += li;
    // }
  }

  function fillTariffGroups() {
    const template = Handlebars.compile($('#tpl-tariff-group-card').html());
    const container = document.getElementById('groups');
    container.innerHTML = '';
    for (var i=0; i<tariffList.length; i++) {
      const item = tariffList[i];
      container.innerHTML += template({
        id: item.id,
        icon: item.icon,
        title: item.name,
        subtitle: item.description,
      });
    }
  }
  function openNationsDialog() {
    onClickNationGroup(document.getElementById('major'));
    $('#roamingMain').css('display', 'none');
    $('#nationsDialog').css('display', 'block');
  }

  function closeDialog() {
    $('#nationsDialog').css('display', 'none');
    $('#scheduleDialog').css('display', 'none');
    $('#roamingMain').css('display', 'block');
  }

  const tariffList = [
    {id: 'baro', name: 'baro 요금제', description: '전세계 주요국가에서', icon: 'icon_planet.png'},
    {id: 'onepass', name: 'One Pass', description: '출장을 자주 간다면', icon: 'icon_onepass.png'},
    {id: 'vip', name: 'One Pass VIP', description: '해외에서도 데이터를 무제한으로', icon: 'icon_vip.png'},
    {id: 'guam', name: '괌사이판', description: '괌,사이판 여행필수품', icon: 'icon_guam.png'},
    {id: 'longpass', name: 'LongPass', description: '중동, 아프리카에서도', icon: 'icon_longpass.png'},
  ];

  const sampleImages = {
    'CHN': '<%= CDN %>/img/product/roam/img_nation_s_01.png',
    'JPN': '<%= CDN %>/img/product/roam/img_nation_s_02.png',
    'VNM': '<%= CDN %>/img/product/roam/img_nation_s_03.png',
    'PHL': '<%= CDN %>/img/product/roam/img_nation_s_04.png',
    'USA': '<%= CDN %>/img/product/roam/img_nation_s_05.png',
    'ITA': '<%= CDN %>/img/product/roam/img_nation_s_06.png',
  };

  // JS 모듈로 분리 고려
  const ISO3166 = {
    'AFG': ['AF', '412'], 'ALB': ['AL', '276'], 'DZA': ['DZ', '603'], 'ASM': ['AS', '544'],
    'AND': ['AD', '213'], 'AGO': ['AO', '631'], 'AIA': ['AI', '365'], 'ATG': ['AG', '344'],
    'ARG': ['AR', '722'], 'ARM': ['AM', '283'], 'ABW': ['AW', '363'], 'AUS': ['AU', '505'],
    'AUT': ['AT', '232'], 'AZE': ['AZ', '400'], 'BHS': ['BS', '364'], 'BHR': ['BH', '426'],
    'BGD': ['BD', '470'], 'BRB': ['BB', '342'], 'BLR': ['BY', '257'], 'BEL': ['BE', '206'],
    'BLZ': ['BZ', '702'], 'BEN': ['BJ', '616'], 'BMU': ['BM', '350'], 'BTN': ['BT', '402'],
    'BOL': ['BO', '736'], 'BES': ['BQ', '362'], 'BIH': ['BA', '218'], 'BWA': ['BW', '652'],
    'BVT': ['BV', '242'], 'BRA': ['BR', '724'], 'BRN': ['BN', '528'], 'BGR': ['BG', '284'],
    'BFA': ['BF', '613'], 'BDI': ['BI', '642'], 'CIV': ['CI', '612'], 'CPV': ['CV', '625'],
    'KHM': ['KH', '456'], 'CMR': ['CM', '624'], 'CAN': ['CA', '302'], 'CYM': ['KY', '346'],
    'CAF': ['CF', '623'], 'TCD': ['TD', '622'], 'CHL': ['CL', '730'], 'CHN': ['CN', '460'],
    'COL': ['CO', '732'], 'COM': ['KM', '654'], 'COG': ['CG', '629'], 'COD': ['CD', '630'],
    'COK': ['CK', '548'], 'CRI': ['CR', '712'], 'HRV': ['HR', '219'], 'CUB': ['CU', '368'],
    'CUW': ['CW', '362'], 'CYP': ['CY', '280'], 'CZE': ['CZ', '230'], 'DNK': ['DK', '238'],
    'DJI': ['DJ', '638'], 'DMA': ['DM', '366'], 'DOM': ['DO', '370'], 'ECU': ['EC', '740'],
    'EGY': ['EG', '602'], 'SLV': ['SV', '706'], 'GNQ': ['GQ', '627'], 'ERI': ['ER', '657'],
    'EST': ['EE', '248'], 'ETH': ['ET', '636'], 'FLK': ['FK', '750'], 'FRO': ['FO', '288'],
    'FJI': ['FJ', '542'], 'FIN': ['FI', '244'], 'FRA': ['FR', '208'], 'GUF': ['GF', '340'],
    'PYF': ['PF', '547'], 'GAB': ['GA', '628'], 'GMB': ['GM', '607'], 'GEO': ['GE', '282'],
    'DEU': ['DE', '262'], 'GHA': ['GH', '620'], 'GIB': ['GI', '266'], 'GRC': ['GR', '202'],
    'GRL': ['GL', '290'], 'GRD': ['GD', '352'], 'GLP': ['GP', '340'], 'GUM': ['GU', '310'],
    'GTM': ['GT', '704'], 'GGY': ['GG', '234'], 'GIN': ['GN', '611'], 'GNB': ['GW', '632'],
    'GUY': ['GY', '738'], 'HTI': ['HT', '372'], 'VAT': ['VA', '225'], 'HND': ['HN', '708'],
    'HKG': ['HK', '454'], 'HUN': ['HU', '216'], 'ISL': ['IS', '274'], 'IND': ['IN', '404'],
    'IDN': ['ID', '510'], 'IRN': ['IR', '432'], 'IRQ': ['IQ', '418'], 'IRL': ['IE', '272'],
    'IMN': ['IM', '234'], 'ISR': ['IL', '425'], 'ITA': ['IT', '222'], 'JAM': ['JM', '338'],
    'JPN': ['JP', '440'], 'JEY': ['JE', '234'], 'JOR': ['JO', '416'], 'KAZ': ['KZ', '401'],
    'KEN': ['KE', '639'], 'KIR': ['KI', '545'], 'PRK': ['KP', '467'], 'KOR': ['KR', '450'],
    'KWT': ['KW', '419'], 'KGZ': ['KG', '437'], 'LAO': ['LA', '457'], 'LVA': ['LV', '247'],
    'LBN': ['LB', '415'], 'LSO': ['LS', '651'], 'LBR': ['LR', '618'], 'LBY': ['LY', '606'],
    'LIE': ['LI', '295'], 'LTU': ['LT', '246'], 'LUX': ['LU', '270'], 'MAC': ['MO', '455'],
    'MKD': ['MK', '294'], 'MDG': ['MG', '646'], 'MWI': ['MW', '650'], 'MYS': ['MY', '502'],
    'MDV': ['MV', '472'], 'MLI': ['ML', '610'], 'MLT': ['MT', '278'], 'MHL': ['MH', '551'],
    'MTQ': ['MQ', '340'], 'MRT': ['MR', '609'], 'MUS': ['MU', '617'], 'MYT': ['YT', '208'],
    'MEX': ['MX', '334'], 'FSM': ['FM', '550'], 'MDA': ['MD', '259'], 'MCO': ['MC', '212'],
    'MNG': ['MN', '428'], 'MNE': ['ME', '297'], 'MSR': ['MS', '354'], 'MAR': ['MA', '604'],
    'MOZ': ['MZ', '643'], 'MMR': ['MM', '414'], 'NAM': ['NA', '649'], 'NRU': ['NR', '536'],
    'NPL': ['NP', '429'], 'NLD': ['NL', '204'], 'NCL': ['NC', '546'], 'NZL': ['NZ', '530'],
    'NIC': ['NI', '710'], 'NER': ['NE', '614'], 'NGA': ['NG', '621'], 'NIU': ['NU', '555'],
    'NFK': ['NF', '505'], 'NOR': ['NO', '242'], 'OMN': ['OM', '422'], 'PAK': ['PK', '410'],
    'PLW': ['PW', '552'], 'PSE': ['PS', '425'], 'PAN': ['PA', '714'], 'PNG': ['PG', '537'],
    'PRY': ['PY', '744'], 'PER': ['PE', '716'], 'PHL': ['PH', '515'], 'POL': ['PL', '260'],
    'PRT': ['PT', '268'], 'PRI': ['PR', '310'], 'QAT': ['QA', '427'], 'REU': ['RE', '647'],
    'ROU': ['RO', '226'], 'RUS': ['RU', '250'], 'RWA': ['RW', '635'], 'KNA': ['KN', '356'],
    'LCA': ['LC', '358'], 'MAF': ['MF', '340'], 'SPM': ['PM', '308'], 'VCT': ['VC', '360'],
    'WSM': ['WS', '549'], 'SMR': ['SM', '292'], 'STP': ['ST', '626'], 'SAU': ['SA', '420'],
    'SEN': ['SN', '608'], 'SRB': ['RS', '220'], 'SYC': ['SC', '633'], 'SLE': ['SL', '619'],
    'SGP': ['SG', '525'], 'SXM': ['SX', '362'], 'SVK': ['SK', '231'], 'SVN': ['SI', '293'],
    'SLB': ['SB', '540'], 'SOM': ['SO', '637'], 'ZAF': ['ZA', '655'], 'SSD': ['SS', '659'],
    'ESP': ['ES', '214'], 'LKA': ['LK', '413'], 'SDN': ['SD', '634'], 'SUR': ['SR', '746'],
    'SWZ': ['SZ', '653'], 'SWE': ['SE', '240'], 'CHE': ['CH', '228'], 'SYR': ['SY', '417'],
    'TWN': ['TW', '466'], 'TJK': ['TJ', '436'], 'TZA': ['TZ', '640'], 'THA': ['TH', '520'],
    'TLS': ['TL', '514'], 'TGO': ['TG', '615'], 'TON': ['TO', '539'], 'TTO': ['TT', '374'],
    'TUN': ['TN', '605'], 'TUR': ['TR', '286'], 'TKM': ['TM', '438'], 'TCA': ['TC', '338'],
    'TUV': ['TV', '553'], 'UGA': ['UG', '641'], 'UKR': ['UA', '255'], 'ARE': ['AE', '424'],
    'GBR': ['GB', '234'], 'USA': ['US', '310'], 'URY': ['UY', '748'], 'UZB': ['UZ', '434'],
    'VUT': ['VU', '541'], 'VEN': ['VE', '734'], 'VNM': ['VN', '452'], 'VGB': ['VG', '348'],
    'ESH': ['EH', '604'], 'YEM': ['YE', '421'], 'ZMB': ['ZM', '645'], 'ZWE': ['ZW', '648'],
    'ALA': ['AX', '244'],
  };

  const nations = {
    'major': '중국, 일본, 베트남, 필리핀, 미국, 이탈리아',
    // EUR
    'europe': '건지섬, 그리스, 네덜란드, 노르웨이, 니제르, 덴마크, 독일, 라트비아, 러시아, 루마니아, 룩셈부르크, 리투아니아, ' +
      '리히텐슈타인, 마케도니아, 맨섬, 모나코, 몬테네그로, 몰타, 바티칸, 벨기에, 벨라루스, 보스니아헤르체고비나, 부르키나파소, ' +
      '불가리아, 산마리노, 세르비아, 스발바르 제도, 스웨덴, 스위스, 스페인, 슬로바키아, 슬로베니아, 아르메니아, 아이슬란드, ' +
      '아일랜드, 알바니아, 에스토니아, 에티오피아, 영국, 오스트리아, 올란드제도, 우크라이나, 이탈리아, 저지섬, 조지아(그루지야), ' +
      '지브롤터, 체코, 크로아티아, 키프로스, 터키, 페로제도, 포르투갈, 폴란드, 프랑스, 핀란드, 헝가리',
    // ASP
    'asia': '네팔, 대만, 라오스, 마카오, 말레이시아, 몽골, 미얀마, 방글라데시, 베트남, 부탄, 브루나이, 스리랑카, ' +
      '싱가포르, 아제르바이젠, 우즈베키스탄, 인도, 인도네시아, 일본, 중국, 카자흐스탄, 캄보디아, 키르기즈스탄, 태국, 파키스탄, 필리핀, 홍콩',
    // AMC
    'america': '과테말라, 니카라과, 도미니카 공화국, 멕시코, 미국, 버진아일랜드, 브라질, 아르헨티나, 에콰도르, 엘살바도르, ' +
      '우루과이, 칠레, 캐나다, 코스타리카, 콜롬비아, 파나마, 페루, 푸에르토리코',
    // OCN
    'oceania': '뉴질랜드, 호주',
    // MET
    'middleeast': '아랍에미리트(UAE), 이스라엘, 카타르',
    // AFT
    'africa': '가봉, 니제르, 르완다, 마다가스카르, 모리셔스, 알제리, 우간다, 이집트, 잠비아, 케냐, 콩고 민주공화국, 차드, 탄자니아',
  };
  var allNations = [];

  var popularNations = <%- JSON.stringify(popularNations) %>;
</script>
<% include ../../components/roaming-next/calendar.javascript.html %>
<% include ../../components/end.component.html %>
