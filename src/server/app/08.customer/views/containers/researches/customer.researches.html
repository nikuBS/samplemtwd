<%#
* @file customer.researches.html
* @author Jiyoung Jo
* @since 2018.11.02
* id: CS_12_01
%>

<%- include('../../components/start.component.html', { pageInfo: locals.pageInfo }); %>
<body>
    <!-- #skip_navigation -->
    <div id="skipNav" class="skip_navi">
        <ul>
            <!-- Grand open 접근성 수정 -->
            <li><a href="#contents-area" class="fe-replace-history">본문 바로가기</a></li>
            <!--  //Grand open 접근성 수정 -->
        </ul>
    </div>
    <!--// #skip_navigation -->
    <div class="wrap" data-menuId="<%= pageInfo.menuId %>">
        <!-- #header -->
        <%- include('../../../common/views/components/header.component.html', { title: '설문조사', svcInfo: svcInfo, pageInfo: locals.pageInfo }); %>
        <!--// #header -->
        <!-- #contents -->
        <div id="contents" class="container-wrap">
            <h2 id="contents-area" tabindex="-1"><span class="blind">본문시작</span></h2>
            <div class="container">
                <!-- .cont-box -->
                
                <hr class="cont-sp type1" aria-hidden="true">
                <div class="cont-box nogaps">
                    <!-- .poll-info -->
                    <div class="poll-info">
                        <h3 class="poll-tit">설문으로 고객님의 의견을<br /> 들려 주세요.</h3>
                    </div>
                    <!--// .poll-info -->
                </div>
                <!--// .cont-box -->
                <!-- option -->    
                <div class="ti-caption-gray bgnone">
                    <button class="bt-select" title="설문 항목 선택" aria-haspopup="true">진행 중 설문조사</button>
                </div>
                <% if (researches.length > 0) { %>
                <!-- 설문조사가 있는 경우 -->
                <!-- .cont-box -->
                <div class="cont-box nogaps-top bgnone noborder">
                    <ul class="tod-poll-list">
                        <%  const DEFAULT_LIST_COUNT = showCount, 
                            leftCount = researches.length - DEFAULT_LIST_COUNT,
                            len = Math.min(DEFAULT_LIST_COUNT, researches.length);

                            for (let i = 0; i < len; i++) {
                                const research = researches[i];
                                let bnnrRsrchTypNm = '';
                                
                                if (research.bnnrRsrchTypCd === 'R') bnnrRsrchTypNm = '설문';
                                else if (research.bnnrRsrchTypCd === 'Q') bnnrRsrchTypNm = '퀴즈';
                                else if (research.bnnrRsrchTypCd === 'P') bnnrRsrchTypNm = '투표';
                        %>
                        <li>
                            <!-- module (ex. 설문) -->
                            <div class="tod-poll-item">
                                <div class="poll-item-conts">
                                    <!-- case, date, label(참여가능 / 참여완료) -->
                                    <div class="poll-item-option">
                                        <span class="poll-type"><%= bnnrRsrchTypNm %></span>
                                        <span class="poll-date"><%= research.staDtm %>~<%= research.endDtm %></span>
                                <% if (ctgCd !== 'E') { %>
                                    <% if (research.cmplYn === 'N') { %>
                                        <span class="label poll-able">참여가능</span>
                                    <% } else if (research.cmplYn === 'Y') { %>
                                        <span class="label poll-disable">참여완료</span>
                                    <% } %>
                                <% } %>
                                    </div>
                                    <!-- 질문 -->
                                    <div class="poll-item-question">
                                        <strong><%= research.bnnrRsrchTitleNm %></strong>
                                    </div>
                                    <% 
                                        if (research.bnnrRsrchTypCd === 'R') {
                                            if (research.qstnHtmlCtt) {
                                                if (research.qstnHtmlCtt !== '<p>&nbsp;</p>') {
                                    %>
                                    <!-- 요약정보 -->
                                    <div class="poll-item-desc">
                                            <%- research.qstnHtmlCtt %>
                                    </div>
                                    <%          }
                                            } %>
                                </div>
                                <!-- button 1개 : col--1 -->
                                <div class="poll-item-btns col--1">
                                    <div class="col"><button type="button" class="btn-poll fe-join-research" data-url="/customer/svc-info/researches?id=<%= research.hintExUrl %>" <%= research.cmplYn === 'Y' ? 'disabled' : '' %>>설문시작하기</button></div>
                                </div>
                                    <%  } else { %>
                                </div>
                                <%
                                            if (ctgCd !== 'E') {
                                %>
                                <!-- button 2개 : col--2 -->
                                <div class="poll-item-btns col--2">
                                    <div class="col"><button type="button" class="btn-poll fe-result-research" data-url="/customer/svc-info/researches/result?id=<%= research.bnnrRsrchId %>" <%= research.bnnrRsrchTypCd === 'Q' && research.cmplYn === 'N' ? 'disabled' : '' %>>결과보기</button></div>
                                    <!-- <div class="col"><button type="button" class="btn-poll fe-submit">참여하기</button></div> -->
                                    <div class="col"><button type="button" class="btn-poll fe-join-pollquiz" data-url="/customer/svc-info/researches?<%= research.bnnrRsrchTypCd === 'Q' ? 'qid=' + research.bnnrRsrchId : 'pid=' + research.bnnrRsrchId %>" <%= research.cmplYn === 'Y' ? 'disabled' : '' %>>참여하기</button></div>
                                </div>
                                <%
                                            } else {
                                %>
                                <!-- button 1개 : col--1 -->
                                <div class="poll-item-btns col--1">
                                        <div class="col"><button type="button" class="btn-poll fe-result-research" data-url="/customer/svc-info/researches/result?id=<%= research.bnnrRsrchId %>">결과보기</button></div>
                                </div>
                                <%
                                            }
                                        } 
                                %>
                            </div>
                            <!-- //module -->
                        </li>
                        <%  } %>
                    </ul>

                    <!-- 더보기 -->
                    <div class="fe-bt-more btn-more no-border btm-line <%= leftCount > 0 ? '' : 'none' %>" aria-hidden="<%= leftCount <= 0 %>">
                        <button>더 보기</button>
                    </div>
                </div>
                <!--// .cont-box -->
                <!--// 설문조사가 있는 경우 -->
                <% } else { %>
                <!-- 설문조사가 없는 경우 -->
                <!-- .cont-box -->
                <div class="cont-box nogaps-hoz">
                    <div class="result-none">
                    <% if (ctgCd !== 'E') { %>
                        진행 중인 설문이 없습니다.
                    <% } else { %>
                        종료된 설문이 없습니다.
                    <% } %>
                    </div>
                </div>
                <!--// .cont-box -->
                <!--// 설문조사가 없는 경우 -->
                <% } %>
            </div>
        </div>
        <!--// #contents -->
        <%- include('../../../../common/views/components/footer.component.html', { svcInfo: svcInfo, pageInfo: pageInfo }); %>
    </div>
</body>

<%- include ../../components/researches/customer.researches.list.html %>
<% include ../../components/javascript.component.html %>
<script>
    $(document).ready(function () {
        new Tw.CustomerResearches($('.wrap'), JSON.parse('<%- JSON.stringify(researches.slice(20)) %>'), '<%=ctgCd%>');
    });
</script>
<% include ../../components/end.component.html %>
