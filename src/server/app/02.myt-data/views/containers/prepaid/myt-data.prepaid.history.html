<%#
* @file myt-data.prepaid.history.html
* @author Jiyoung Jo
* @since 2018.11.20
* id: DC_09_06
%>

<%- include('../../components/start.component.html', { pageInfo: locals.pageInfo }); %>
<body>
    <!-- #skip_navigation -->
    <div id="skipNav" class="skip_navi">
        <ul>
            <!-- Grand open 접근성 수정 -->
            <li><a href="#contents" class="fe-replace-history">본문 바로가기</a></li>
            <!--  //Grand open 접근성 수정 -->
        </ul>
    </div>
    <!--// #skip_navigation -->
    <div class="wrap" data-menuId="<%= pageInfo.menuId %>">
        <!-- #header -->
        <%- include('../../../common/views/components/header.component.html', { title: '충전 내역', svcInfo: svcInfo, pageInfo: locals.pageInfo }); %>
        <!--// #header -->
        <!-- #contents -->
        <div class="container-wrap">
            <h2 id="contents" tabindex="-1"><span class="blind">본문시작</span></h2>
            <div class="container">
                <!-- .cont-box -->
                <div class="cont-box nogaps">
                    <% const visibleVoice = visible === 'voice';
                    const totalCount = visibleVoice? voice.count : data.count; 
                    const BADGE = {
                        1: { icon: 'auto', name: '1회' },
                        2: { icon: 'one', name: '자동' },
                        4: { icon: 'succession', name: '잔액승계' }
                    } %>
                    <div class="ti-caption-gray">
                        <button class="bt-select" title="충전 데이터 유형 선택" aria-haspopup="true" data-type="<%= visibleVoice ? 'voice' : 'data' %>"><%= visibleVoice? '음성' : '데이터' %></button>
                        <div class="num">
                            총 <em data-voice="<%= voice.count %>" data-data="<%= data.count %>"><%= totalCount %></em>건
                        </div>
                    </div>
                    <div class="list-comp-history">
                        <ul class="comp-box">
                            <% Object.keys(voice.histories).reverse().map(date => { %>
                                <li class="list-box fe-prepaid-voice <%= visibleVoice ? '': 'none' %>" aria-hidden="<%= !visibleVoice %>" data-key="<%= date %>">
                                    <p class="list-date">
                                        <span class="date-tx"><%= voice.histories[date][0].date %></span>
                                    </p>
                                    <ul class="list-con">
                                        <% voice.histories[date].map(history => { %>
                                        <li>
                                            <p class="list-text">
                                                <% const badge = BADGE[history.chargeTp]; %>
                                                <span class="stext-b">
                                                    <% if (badge) { %>
                                                        <i class="badge badge-<%= badge.icon %>"><span class="blind"><%= badge.name %></span></i>
                                                    <% } %>
                                                    음성 충전</span>
                                                <span class="stext">
                                                    <span class="black-tx"><%= history.payNm %></span>
                                                    <span class="gray-tx"><%= history.cardNm || '신용카드' %></span>
                                                </span>
                                            </p>
                                            <div class="list-data">
                                                <button class="bt-link data-tx <%= history.isCanceled ? 'gray-tx' : 'blue-tx'%>" data-origin-idx="<%= history.idx %>"><%= history.amt %>원</button>
                                                <% if (history.rfndPsblYn === 'Y') { %>
                                                    <button class="bt-link-tx underline red fe-cancel" data-cancel-id="<%= history.cancelOrderId %>" data-page-number="1">취소</button>
                                                <% } %>
                                            </div>
                                        </li>
                                        <% }); %>
                                    </ul>
                                </li>
                            <% }); %>
                            <%  Object.keys(data.histories).reverse().map(date => { %>
                                <li class="list-box fe-prepaid-data <%= visibleVoice ? 'none' : ''%>" aria-hidden="<%= visibleVoice %>" data-key="<%= date %>">
                                    <p class="list-date">
                                        <span class="date-tx"><%= data.histories[date][0].date %></span>
                                    </p>
                                    <ul class="list-con">
                                        <% data.histories[date].map(history => { %>
                                        <li>
                                            <p class="list-text">
                                                <% const badge = BADGE[history.chargeTp]; %>
                                                <span class="stext-b">
                                                    <% if (badge) { %>
                                                    <i class="badge badge-<%= badge.icon %>"><span class="blind"><%= badge.name %></span></i> 
                                                    <% } %>
                                                    데이터 충전<span class="data"> <%= history.data %></span>
                                                </span>
                                                <span class="stext">
                                                    <span class="black-tx"><%= history.payNm %></span>
                                                    <span class="gray-tx"><%= history.cardNm || '신용카드' %></span>
                                                </span>
                                            </p>
                                            <div class="list-data">
                                                <button class="bt-link data-tx <%= history.isCanceled ? 'gray-tx' : 'blue-tx'%>" data-origin-idx="<%= history.idx %>"><%= history.amt %>원</button>
                                                <% if (history.rfndPsblYn === 'Y') { %>
                                                    <button class="bt-link-tx underline red fe-cancel" data-cancel-id="<%= history.cancelOrderId %>" data-charge-code="<%= history.dataChargeCd %>">취소</button>
                                                <% } %>
                                            </div>
                                        </li>
                                        <% }); %>
                                    </ul>
                                </li>
                            <% }); %>
                        </ul>
                    </div>
                    <% const leftCount = totalCount - 20; %>
                    <div class="bt-more <%= leftCount > 0 ? '' : 'none'%>" aria-hidden="<%= leftCount <= 0 %>">
                        <button>더 보기</button>
                    </div>
                    <div class="contents-empty <%= totalCount === 0 ? '' : 'none'%>" aria-hidden="<%= totalCount > 0 %>">
                        <span class="ico type1"><span class="blind">느낌표(!)</span></span>
                        <p class="desc">선불폰 충전 내역이 없습니다.</p>
                    </div>
                </div>
                <!--// .cont-box -->
                
            </div>
        </div>
        <!--// #contents -->
        <%- include('../../../common/views/components/footer.component.html', { svcInfo: svcInfo, pageInfo: pageInfo }); %>
    </div>
</body>
<%- include ../../components/prepaid/myt-data.prepaid.history.list.html %>
<% include ../../components/javascript.component.html %>
<script>
    $(document).ready(function() {
        new Tw.MyTDataPrepaidHistory($('.wrap'), { voice: <%- JSON.stringify(voice.origin) %>, data: <%- JSON.stringify(data.origin) %> });
    });
</script>
<% include ../../components/end.component.html %>
</body>
