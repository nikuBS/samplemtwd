<%#
* FileName: myt-data.prepaid.history.html
* Author: Jiyoung Jo (jiyoungjo@sk.com)
* Date: 2018.11.20
* id: DC_09_06
%>

<% include ../../components/start.component.html %>
<body>
    <!-- #skip_navigation -->
    <div id="skipNav" class="skip_navi">
        <ul>
            <li><a href="#gnb">메뉴 바로가기</a></li>
            <li><a href="#contents">본문 바로가기</a></li>
            <li><a href="#footer">푸터 바로가기</a></li>
        </ul>
    </div>
    <!--// #skip_navigation -->
    <div class="wrap" data-menuId="<%= pageInfo.menuId %>">
        <!-- #header -->
        <%- include('../../../common/views/components/header.component.html', { title: '충전 내역' }); %>
        <!--// #header -->
        <!-- #contents -->
        <div id="contents" class="container-wrap">
            <h2 class="blind">내용</h2>
            <div class="container">
                <!-- .cont-box -->
                <div class="cont-box nogaps">
                    <% const visibleVoice = voice.histories.hasOwnProperty(recentDate);
                    const totalCount = visibleVoice? voice.count : data.count; 
                    const BADGE = {
                        1: { icon: 'auto', name: '1회' },
                        2: { icon: 'one', name: '자동' },
                        4: { icon: 'succession', name: '잔액승계' }
                    } %>
                    <div class="ti-caption-gray">
                        <button class="bt-select" title="충전 데이터 유형 선택" aria-haspopup="true" data-type="<%= visibleVoice ? 'voice' : 'data' %>"><%= visibleVoice? '음성' : '데이터' %></button>
                        <div class="num">
                            총 <em data-voice="<%= voice.count %>" data-data="<%= data.count %>"><%= totalCount %></em>건
                        </div>
                    </div>
                    <div class="list-comp-history">
                        <ul class="comp-box">
                            <% let displayedYear = (new Date()).getFullYear().toString();
                            Object.keys(voice.histories).reverse().map(date => { 
                                const itemYear = date.substring(0, 4); %>
                                <% if (itemYear !== displayedYear) { %>
                                    <li class="year-tx <%= visibleVoice ? '': 'none' %>" data-year="<%= itemYear %>" data-type="voice"><%= itemYear %></li>
                                <% displayedYear = itemYear; 
                                } %>
                                <li class="list-box <%= visibleVoice ? '': 'none' %>" data-type="voice" data-key="<%= date %>">
                                    <p class="list-date">
                                        <span class="date-tx"><%= voice.histories[date][0].date %></span>
                                    </p>
                                    <ul class="list-con">
                                        <% voice.histories[date].map(history => { %>
                                        <li>
                                            <p class="list-text">
                                                <% const badge = BADGE[history.chargeTp]; %>
                                                <span class="stext-b">
                                                    <% if (badge) { %>
                                                        <i class="badge badge-<%= badge.icon %>"><span class="blind"><%= badge.name %></span></i>
                                                    <% } %>
                                                음성 충전</span>
                                                <span class="stext"><span class="gray-tx"><%= history.cardNm %></span><span class="gray-tx"><%= history.payNm %></span></span>
                                            </p>
                                            <div class="list-data">
                                                <button class="bt-link data-tx <%= history.isCanceled ? 'gray-tx' : 'blue-tx'%>" data-origin-idx="<%= history.idx %>"><%= history.amt %>원</button>
                                                <% if (history.rfndPsblYn === 'Y') { %>
                                                    <button class="bt-link-tx underline red" data-cancel-id="<%= history.cancelOrderId %>" data-page-number="1">취소</button>
                                                <% } %>
                                            </div>
                                        </li>
                                        <% }); %>
                                    </ul>
                                </li>
                            <% }); %>
                            <% displayedYear = (new Date()).getFullYear().toString();
                                Object.keys(data.histories).reverse().map(date => { 
                                const itemYear = date.substring(0, 4); %>
                                <% if (itemYear !== displayedYear) { %>
                                    <li class="year-tx <%= visibleVoice ? 'none': '' %>" data-year="<%= itemYear %>" data-type="data"><%= itemYear %></li>
                                <% displayedYear = itemYear; 
                                } %>
                                <li class="list-box <%= visibleVoice ? 'none' : ''%>" data-type="data" data-key="<%= date %>">
                                    <p class="list-date">
                                        <span class="date-tx"><%= data.histories[date][0].date %></span>
                                    </p>
                                    <ul class="list-con">
                                        <% data.histories[date].map(history => { %>
                                        <li>
                                            <p class="list-text">
                                                <% const badge = BADGE[history.chargeTp]; %>
                                                <span class="stext-b">
                                                    <% if (badge) { %>
                                                    <i class="badge badge-<%= badge.icon %>"><span class="blind"><%= badge.name %></span></i> 
                                                    <% } %>
                                                    데이터 충전<span class="data"> <%= history.data %></span>
                                                </span>
                                                <span class="stext"><span class="gray-tx"><%= history.cardNm %></span><span class="black-tx"><%= history.payNm %></span></span>
                                            </p>
                                            <div class="list-data">
                                                <button class="bt-link data-tx <%= history.isCanceled ? 'gray-tx' : 'blue-tx'%>" data-origin-idx="<%= history.idx %>"><%= history.amt %>원</button>
                                                <% if (history.rfndPsblYn === 'Y') { %>
                                                    <button class="bt-link-tx underline red" data-cancel-id="<%= history.cancelOrderId %>" data-charge-code="<%= history.dataChargeCd %>">취소</button>
                                                <% } %>
                                            </div>
                                        </li>
                                        <% }); %>
                                    </ul>
                                </li>
                            <% }); %>
                        </ul>
                    </div>
                    <div class="bt-more <%= totalCount - 20 > 0 ? '' : 'none'%>">
                        <button>더 보기</button>
                    </div>
                </div>
                <!--// .cont-box -->
                
            </div>
        </div>
        <!--// #contents -->
        <%- include('../../../common/views/components/footer.component.html', { svcInfo: svcInfo, pageInfo: pageInfo }); %>
    </div>
</body>
<%- include ../../components/prepaid/myt-data.prepaid.history.list.html %>
<% include ../../components/javascript.component.html %>
<script>
    $(document).ready(function() {
        new Tw.MyTDataPrepaidHistory($('.wrap'), { voice: <%- JSON.stringify(voice.origin) %>, data: <%- JSON.stringify(data.origin) %> });
    });
</script>
<% include ../../components/end.component.html %>
</body>