<%#
* FileName: myt-data.familydata.html
* Author: Jiyoung Jo (jiyoungjo@sk.com)
* Date: 2018.09.28
* id: DC_02
%>

<%- include('../../components/start.component.html', { pageInfo: locals.pageInfo }); %>
<body>
<!-- #skip_navigation -->
<div id="skipNav" class="skip_navi">
    <ul>
        <!-- Grand open 접근성 수정 -->
        <li><a href="#contents" class="fe-replace-history">본문 바로가기</a></li>
        <!--  //Grand open 접근성 수정 -->
    </ul>
</div>
<!--// #skip_navigation -->
<div class="wrap" data-menuId="<%= pageInfo.menuId %>">
    <!-- #header -->
    <%- include('../../../common/views/components/header.component.html', { title: 'T가족모아데이터', svcInfo: svcInfo, pageInfo: locals.pageInfo }); %>
    <% const INFINITY = 'NA00005959'; %>
    <!--// #header -->
    <!-- #contents -->
    <div id="contents" class="container-wrap">
        <h2 class="blind">내용</h2>
        <div class="container">
            <hr class="cont-sp type1" aria-hidden="true" />
            <!-- .cont-box -->
            <div class="cont-box nogaps">
                <% if (familyInfo.mine) { %>
                <ul class="data-realtime-wrap">
                    <li>
                        <% const data = familyInfo.mine.data,
                            total = data.hasLimit ? Math.min(data.myLimitation, data.total) : data.total, 
                            ratio = data.hasLimit && data.myLimitation === 0 ? 0 : Math.floor(familyInfo.mine.nRemained / total * 100); %>
                        <div class="graph">
                            <div class="donut-chart small">
                                <div class="donut-chart-area">
                                    <!-- loop -->
                                    <div id="fe-data-graph" class="c100 p<%= ratio %>"><!-- .p+(0~100) // -->
                                        <div class="blue"><!-- red, yellow, green, blue // -->
                                            <div class="slice">
                                                <div class="bar"></div>
                                                <div class="fill"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- // loop -->
                                </div>
                            </div>
                        </div>
                        <div class="cont">
                            <span class="stit">나의 T가족모아데이터<button id="DC_02_tip_01" class="btn-tip" aria-haspopup="true"><i class="icon-badge-tip"><span class="blind">나의 T가족모아데이터 tip</span></i></button></span>
                            <span class="txt1"><span class="ff-type1" id="fe-remained-data"><%= familyInfo.mine.nRemained > 0 ? familyInfo.mine.remained.data + familyInfo.mine.remained.unit : '0KB' %> </span>남음</span>
                        </div>
                        <% if (familyInfo.mine.shrblYn === "Y") { %>
                        <span class="btn-r">
                            <a href="/myt-data/familydata/share" class="btn-round2 btn-style3">공유</a>
                        </span>
                        <% } %>
                    </li>
                </ul>
                <% } %>
                <div class="total-data">
                    <span class="stit">총 가족 공유 데이터</span>
                    <span class="r-txt"><span class="ff-type1"><%= familyInfo.total > 0 ? familyInfo.total + 'GB' : '0KB' %></span></span>
                </div>
            </div>
            <!--// .cont-box -->
            <hr class="cont-sp type1" aria-hidden="true" />
            <div class="cont-box">
                <div class="ti-caption-type01">
                    <h2 class="tit">이용현황</h2>
                </div>
                <div class="use-state-wrap">
                    <ul>
                        <% familyInfo.mbrList.map(member => { 
                            const isInfinity = member.prodId === INFINITY, isMine = member.svcMgmtNum === familyInfo.mine.svcMgmtNum; %>
                            <li data-member="<%= JSON.stringify({ name: member.custNm, svcNum: member.svcNum, isRepresentation: member.repYn === 'Y', mgmtNum: member.svcMgmtNum }) %>">
                                <span class="icon"><i class="icon-cellphone-48"><span class="blind">cellphone</span></i></span>
                                <div class="info">
                                    <span class="stit">
                                        <%= member.custNm %>
                                        <% if (member.repYn === 'Y') { %>
                                            <span class="sicon"><i class="icon-f-delegate"><span class="blind">가족대표</span></i></span>
                                        <% } %>
                                    </span>
                                    <span class="r-txt">
                                        <% if (isInfinity) { %>
                                            <span class="ff-type1">무제한</span>
                                        <% } else { %>
                                            <span class="ff-type1"><%= member.used.data > 0 ? member.used.data + member.used.unit : '0KB' %></span>이용
                                        <% } %>
                                    </span>
                                    <p><%= member.svcNum %></p>
                                </div>
                                <div class="detail">
                                    <dl>
                                        <dt>이용요금제</dt>
                                        <dd><%= member.prodNm %></dd>
                                        <dt>공유한 데이터</dt>
                                        <dd><%= member.shared > 0 ? member.shared + 'GB' : '0KB' %></dd>
                                        <% if (!isInfinity) { %>
                                            <dt>이용한도</dt>
                                            <dd>
                                                <span><%= member.limitedYn === 'Y' ? member.limitation + 'GB' : '자유 사용' %></span>
                                                <% if (familyInfo.isRepresentation) { %>
                                                <button class="bt-link-tx underline fe-setting-limit" data-limitation="<%= member.limitedYn === 'Y' && member.limitation %>" data-is-mine="<%= isMine %>">설정</button>
                                                <% } %>
                                            </dd>
                                        <% } %>
                                    </dl>
                                </div>
                            </li>
                        <% }); %>
                    </ul>
                </div>
            </div>
            <!--// .cont-box -->

            <hr class="cont-sp type1" aria-hidden="true">

            <% if (histories > 0) { %>
            <!-- .cont-box -->
            <div class="cont-box nogaps">
                <div class="calling-plan type3">
                    <a class="wrap-link fs-type01" href="/myt-data/familydata/history?amount=<%= familyInfo.mine.shared %>">
                        <span class="left">이번 달 공유한 데이터 변경하기</span>
                        <span class="right fc-type01"><strong class="fs-type03"><%= histories %>건</strong></span>
                    </a>
                </div>
            </div>
            <!--// .cont-box -->
            <% } %>

            <div class="cont-box noborder bgnone">
                <h3 class="pg-chk-tit">꼭 확인해 주세요</h3>
                <ul class="pg-chk-list02">
                    <li><button id="DC_02_tip_02" class="btn-tip" aria-haspopup="true">T가족모아데이터 유의사항<i class="icon-badge-tip"><span class="blind">>T가족모아데이터 유의사항 tip</span></i></button></li>
                    <li><button id="DC_02_tip_03" class="btn-tip" aria-haspopup="true">T가족모아데이터 이용한도 설정 안내<i class="icon-badge-tip"><span class="blind">>T가족모아데이터 이용한도 설정 안내 tip</span></i></button></li>
                </ul>
            </div>
        </div>
    </div>
    <!--// #contents -->
    <%- include('../../../common/views/components/footer.component.html', { svcInfo: svcInfo, pageInfo: pageInfo }); %>
</div>
</body>
<% include ../../components/javascript.component.html %>
<script>
  $(document).ready(function () {
    new Tw.MyTDataFamily($('.container-wrap'), <%- JSON.stringify(familyInfo.mine.data) %>);
  });
</script>
<% include ../../components/end.component.html %>
